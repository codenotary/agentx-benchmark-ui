!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.JSONIC=e():t.JSONIC=e()}(this,function(){return function(){"use strict";var t={125:function(t,e,n){t.exports=n.p+"wasm/jsonic_wasm_bg.cbda8e46acdb745ff88f.wasm"}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}n.m=t,n.d=function(t,e){for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},function(){var t;n.g.importScripts&&(t=n.g.location+"");var e=n.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var r=e.getElementsByTagName("script");if(r.length)for(var o=r.length-1;o>-1&&(!t||!/^http(s?):/.test(t));)t=r[o--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=t}(),n.b=document.baseURI||self.location.href;var r={};let o;n.d(r,{default:function(){return T}});let i=null;function _(){return null!==i&&0!==i.byteLength||(i=new Uint8Array(o.memory.buffer)),i}let s="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&s.decode();let a=0;function d(t,e){return function(t,e){return a+=e,a>=2146435072&&(s="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}},s.decode(),a=e),s.decode(_().subarray(t,t+e))}(t>>>=0,e)}const c=new Array(128).fill(void 0);c.push(void 0,null,!0,!1);let f=c.length;function g(t){f===c.length&&c.push(c.length+1);const e=f;return f=c[e],c[e]=t,e}function b(t){return c[t]}let u=0;const w="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},p="function"==typeof w.encodeInto?function(t,e){return w.encodeInto(t,e)}:function(t,e){const n=w.encode(t);return e.set(n),{read:t.length,written:n.length}};function l(t,e,n){if(void 0===n){const n=w.encode(t),r=e(n.length,1)>>>0;return _().subarray(r,r+n.length).set(n),u=n.length,r}let r=t.length,o=e(r,1)>>>0;const i=_();let s=0;for(;s<r;s++){const e=t.charCodeAt(s);if(e>127)break;i[o+s]=e}if(s!==r){0!==s&&(t=t.slice(s)),o=n(o,r,r=s+3*t.length,1)>>>0;const e=_().subarray(o+s,o+r);s+=p(t,e).written,o=n(o,r,s,1)>>>0}return u=s,o}let y=null;function h(){return(null===y||!0===y.buffer.detached||void 0===y.buffer.detached&&y.buffer!==o.memory.buffer)&&(y=new DataView(o.memory.buffer)),y}function x(t,e){return t>>>=0,_().subarray(t/1,t/1+e)}function m(t){const e=b(t);return function(t){t<132||(c[t]=f,f=t)}(t),e}const I="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>o.__wbg_jsondb_free(t>>>0,1));class v{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,I.unregister(this),t}free(){const t=this.__destroy_into_raw();o.__wbg_jsondb_free(t,0)}constructor(){try{const n=o.__wbindgen_add_to_stack_pointer(-16);o.jsondb_new(n);var t=h().getInt32(n+0,!0),e=h().getInt32(n+4,!0);if(h().getInt32(n+8,!0))throw m(e);return this.__wbg_ptr=t>>>0,I.register(this,this.__wbg_ptr,this),this}finally{o.__wbindgen_add_to_stack_pointer(16)}}insert(t){try{const r=o.__wbindgen_add_to_stack_pointer(-16),i=l(t,o.__wbindgen_export_0,o.__wbindgen_export_1),_=u;o.jsondb_insert(r,this.__wbg_ptr,i,_);var e=h().getInt32(r+0,!0),n=h().getInt32(r+4,!0);if(h().getInt32(r+8,!0))throw m(n);return m(e)}finally{o.__wbindgen_add_to_stack_pointer(16)}}get(t){try{const r=o.__wbindgen_add_to_stack_pointer(-16),i=l(t,o.__wbindgen_export_0,o.__wbindgen_export_1),_=u;o.jsondb_get(r,this.__wbg_ptr,i,_);var e=h().getInt32(r+0,!0),n=h().getInt32(r+4,!0);if(h().getInt32(r+8,!0))throw m(n);return m(e)}finally{o.__wbindgen_add_to_stack_pointer(16)}}insert_many(t){try{const r=o.__wbindgen_add_to_stack_pointer(-16),i=l(t,o.__wbindgen_export_0,o.__wbindgen_export_1),_=u;o.jsondb_insert_many(r,this.__wbg_ptr,i,_);var e=h().getInt32(r+0,!0),n=h().getInt32(r+4,!0);if(h().getInt32(r+8,!0))throw m(n);return m(e)}finally{o.__wbindgen_add_to_stack_pointer(16)}}update(t,e){try{const i=o.__wbindgen_add_to_stack_pointer(-16),_=l(t,o.__wbindgen_export_0,o.__wbindgen_export_1),s=u,a=l(e,o.__wbindgen_export_0,o.__wbindgen_export_1),d=u;o.jsondb_update(i,this.__wbg_ptr,_,s,a,d);var n=h().getInt32(i+0,!0),r=h().getInt32(i+4,!0);if(h().getInt32(i+8,!0))throw m(r);return m(n)}finally{o.__wbindgen_add_to_stack_pointer(16)}}update_many(t){try{const r=o.__wbindgen_add_to_stack_pointer(-16),i=l(t,o.__wbindgen_export_0,o.__wbindgen_export_1),_=u;o.jsondb_update_many(r,this.__wbg_ptr,i,_);var e=h().getInt32(r+0,!0),n=h().getInt32(r+4,!0);if(h().getInt32(r+8,!0))throw m(n);return m(e)}finally{o.__wbindgen_add_to_stack_pointer(16)}}delete(t){try{const r=o.__wbindgen_add_to_stack_pointer(-16),i=l(t,o.__wbindgen_export_0,o.__wbindgen_export_1),_=u;o.jsondb_delete(r,this.__wbg_ptr,i,_);var e=h().getInt32(r+0,!0),n=h().getInt32(r+4,!0);if(h().getInt32(r+8,!0))throw m(n);return m(e)}finally{o.__wbindgen_add_to_stack_pointer(16)}}delete_many(t){try{const r=o.__wbindgen_add_to_stack_pointer(-16),i=l(t,o.__wbindgen_export_0,o.__wbindgen_export_1),_=u;o.jsondb_delete_many(r,this.__wbg_ptr,i,_);var e=h().getInt32(r+0,!0),n=h().getInt32(r+4,!0);if(h().getInt32(r+8,!0))throw m(n);return m(e)}finally{o.__wbindgen_add_to_stack_pointer(16)}}stats(){try{const n=o.__wbindgen_add_to_stack_pointer(-16);o.jsondb_stats(n,this.__wbg_ptr);var t=h().getInt32(n+0,!0),e=h().getInt32(n+4,!0);if(h().getInt32(n+8,!0))throw m(e);return m(t)}finally{o.__wbindgen_add_to_stack_pointer(16)}}list_ids(){try{const n=o.__wbindgen_add_to_stack_pointer(-16);o.jsondb_list_ids(n,this.__wbg_ptr);var t=h().getInt32(n+0,!0),e=h().getInt32(n+4,!0);if(h().getInt32(n+8,!0))throw m(e);return m(t)}finally{o.__wbindgen_add_to_stack_pointer(16)}}query(t){try{const r=o.__wbindgen_add_to_stack_pointer(-16),i=l(t,o.__wbindgen_export_0,o.__wbindgen_export_1),_=u;o.jsondb_query(r,this.__wbg_ptr,i,_);var e=h().getInt32(r+0,!0),n=h().getInt32(r+4,!0);if(h().getInt32(r+8,!0))throw m(n);return m(e)}finally{o.__wbindgen_add_to_stack_pointer(16)}}query_with_options(t,e){try{const i=o.__wbindgen_add_to_stack_pointer(-16),_=l(t,o.__wbindgen_export_0,o.__wbindgen_export_1),s=u,a=l(e,o.__wbindgen_export_0,o.__wbindgen_export_1),d=u;o.jsondb_query_with_options(i,this.__wbg_ptr,_,s,a,d);var n=h().getInt32(i+0,!0),r=h().getInt32(i+4,!0);if(h().getInt32(i+8,!0))throw m(r);return m(n)}finally{o.__wbindgen_add_to_stack_pointer(16)}}create_index(t,e){try{const i=o.__wbindgen_add_to_stack_pointer(-16),_=l(t,o.__wbindgen_export_0,o.__wbindgen_export_1),s=u,a=l(e,o.__wbindgen_export_0,o.__wbindgen_export_1),d=u;o.jsondb_create_index(i,this.__wbg_ptr,_,s,a,d);var n=h().getInt32(i+0,!0),r=h().getInt32(i+4,!0);if(h().getInt32(i+8,!0))throw m(r);return m(n)}finally{o.__wbindgen_add_to_stack_pointer(16)}}drop_index(t){try{const r=o.__wbindgen_add_to_stack_pointer(-16),i=l(t,o.__wbindgen_export_0,o.__wbindgen_export_1),_=u;o.jsondb_drop_index(r,this.__wbg_ptr,i,_);var e=h().getInt32(r+0,!0),n=h().getInt32(r+4,!0);if(h().getInt32(r+8,!0))throw m(n);return m(e)}finally{o.__wbindgen_add_to_stack_pointer(16)}}list_indexes(){try{const n=o.__wbindgen_add_to_stack_pointer(-16);o.jsondb_list_indexes(n,this.__wbg_ptr);var t=h().getInt32(n+0,!0),e=h().getInt32(n+4,!0);if(h().getInt32(n+8,!0))throw m(e);return m(t)}finally{o.__wbindgen_add_to_stack_pointer(16)}}aggregate(t){try{const r=o.__wbindgen_add_to_stack_pointer(-16),i=l(t,o.__wbindgen_export_0,o.__wbindgen_export_1),_=u;o.jsondb_aggregate(r,this.__wbg_ptr,i,_);var e=h().getInt32(r+0,!0),n=h().getInt32(r+4,!0);if(h().getInt32(r+8,!0))throw m(n);return m(e)}finally{o.__wbindgen_add_to_stack_pointer(16)}}clear(){try{const n=o.__wbindgen_add_to_stack_pointer(-16);o.jsondb_clear(n,this.__wbg_ptr);var t=h().getInt32(n+0,!0),e=h().getInt32(n+4,!0);if(h().getInt32(n+8,!0))throw m(e);return m(t)}finally{o.__wbindgen_add_to_stack_pointer(16)}}}"undefined"==typeof FinalizationRegistry||new FinalizationRegistry(t=>o.__wbg_wasmsharedbuffer_free(t>>>0,1));const j=new Set(["basic","cors","default"]);function k(){const t={wbg:{}};return t.wbg.__wbg_Error_1f3748b298f99708=function(t,e){return g(Error(d(t,e)))},t.wbg.__wbg_String_8f0eb39a4a4c2f66=function(t,e){const n=l(String(b(e)),o.__wbindgen_export_0,o.__wbindgen_export_1),r=u;h().setInt32(t+4,r,!0),h().setInt32(t+0,n,!0)},t.wbg.__wbg_error_7534b8e9a36f1ab4=function(t,e){let n,r;try{n=t,r=e,console.error(d(t,e))}finally{o.__wbindgen_export_2(n,r,1)}},t.wbg.__wbg_getRandomValues_38a1ff1ea09f6cc7=function(){return function(t,e){try{return t.apply(this,e)}catch(t){o.__wbindgen_export_3(g(t))}}(function(t,e){globalThis.crypto.getRandomValues(x(t,e))},arguments)},t.wbg.__wbg_getTime_5b1dd03bb6d4b784=function(t){return b(t).getTime()},t.wbg.__wbg_log_f3c04200b995730f=function(t){console.log(b(t))},t.wbg.__wbg_new0_85cc856927102294=function(){return g(new Date)},t.wbg.__wbg_new_1930cbb8d9ffc31b=function(){return g(new Object)},t.wbg.__wbg_new_56407f99198feff7=function(){return g(new Map)},t.wbg.__wbg_new_8a6f238a6ece86ea=function(){return g(new Error)},t.wbg.__wbg_new_e969dc3f68d25093=function(){return g(new Array)},t.wbg.__wbg_now_e3057dd824ca0191=function(){return Date.now()},t.wbg.__wbg_set_31197016f65a6a19=function(t,e,n){return g(b(t).set(b(e),b(n)))},t.wbg.__wbg_set_3f1d0b984ed272ed=function(t,e,n){b(t)[m(e)]=m(n)},t.wbg.__wbg_set_d636a0463acf1dbc=function(t,e,n){b(t)[e>>>0]=m(n)},t.wbg.__wbg_stack_0ed75d68575b0f3c=function(t,e){const n=l(b(e).stack,o.__wbindgen_export_0,o.__wbindgen_export_1),r=u;h().setInt32(t+4,r,!0),h().setInt32(t+0,n,!0)},t.wbg.__wbg_wbindgenisstring_4b74e4111ba029e6=function(t){return"string"==typeof b(t)},t.wbg.__wbg_wbindgenthrow_4c11a24fca429ccf=function(t,e){throw new Error(d(t,e))},t.wbg.__wbindgen_cast_2241b6af4c4b2941=function(t,e){return g(d(t,e))},t.wbg.__wbindgen_cast_4625c577ab2ec9ee=function(t){return g(BigInt.asUintN(64,t))},t.wbg.__wbindgen_cast_9ae0607507abb057=function(t){return g(t)},t.wbg.__wbindgen_cast_d6cd19b81560fd6e=function(t){return g(t)},t.wbg.__wbindgen_object_clone_ref=function(t){return g(b(t))},t.wbg.__wbindgen_object_drop_ref=function(t){m(t)},t}function O(t,e){return o=t.exports,S.__wbindgen_wasm_module=e,y=null,i=null,o}async function S(t){if(void 0!==o)return o;void 0!==t&&(Object.getPrototypeOf(t)===Object.prototype?({module_or_path:t}=t):console.warn("using deprecated parameters for the initialization function; pass a single object instead")),void 0===t&&(t=new URL(n(125),n.b));const e=k();("string"==typeof t||"function"==typeof Request&&t instanceof Request||"function"==typeof URL&&t instanceof URL)&&(t=fetch(t));const{instance:r,module:i}=await async function(t,e){if("function"==typeof Response&&t instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(t,e)}catch(e){if(!t.ok||!j.has(t.type)||"application/wasm"===t.headers.get("Content-Type"))throw e;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",e)}const n=await t.arrayBuffer();return await WebAssembly.instantiate(n,e)}{const n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}(await t,e);return O(r,i)}var A=S;class N{constructor(t,e){this.db=t,this.name=e}async insertOne(t){const e={_id:"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():this.generateUUID(),...t},n=this.db.insert(JSON.stringify(e));if("string"==typeof n){const t=JSON.parse(n);if(t.success)return e;throw new Error(t.error||"Insert failed")}return e}async insertMany(t){const e=[];for(const n of t){const t=await this.insertOne(n);t._id&&e.push(t._id)}return{insertedCount:e.length,insertedIds:e}}async findOne(t={}){return(await this.find(t).limit(1).toArray())[0]||null}find(t={}){const e=this;let n,r,o;const i={async toArray(){const i=e.db.list_ids();let _=[];if("string"==typeof i){const t=JSON.parse(i);if(t.success&&Array.isArray(t.data))for(const n of t.data){const t=e.db.get(n);if("string"==typeof t){const e=JSON.parse(t);e.success&&_.push(e.data)}}}return Object.keys(t).length>0&&(_=_.filter(e=>{for(const[n,r]of Object.entries(t))if(e[n]!==r)return!1;return!0})),o&&_.sort((t,e)=>{const n=t[o.field],r=e[o.field];return n<r?-o.order:n>r?o.order:0}),void 0!==r&&(_=_.slice(r)),void 0!==n&&(_=_.slice(0,n)),_},limit(t){return n=t,i},skip(t){return r=t,i},sortBy(t,e=1){return o={field:t,order:e},i}};return i}async updateOne(t,e){const n=await this.findOne(t);if(!n||!n._id)return{matchedCount:0,modifiedCount:0};const r=this.applyUpdate(n,e),o=this.db.update(n._id,JSON.stringify(r));if("string"==typeof o){if(JSON.parse(o).success)return{matchedCount:1,modifiedCount:1}}return{matchedCount:1,modifiedCount:0}}async updateMany(t,e){const n=await this.find(t).toArray();let r=0;for(const t of n)if(t._id){const n=this.applyUpdate(t,e),o=this.db.update(t._id,JSON.stringify(n));if("string"==typeof o){JSON.parse(o).success&&r++}}return{matchedCount:n.length,modifiedCount:r}}async deleteOne(t){const e=await this.findOne(t);if(!e||!e._id)return{deletedCount:0};const n=this.db.delete(e._id);if("string"==typeof n){if(JSON.parse(n).success)return{deletedCount:1}}return{deletedCount:0}}async deleteMany(t){const e=await this.find(t).toArray();let n=0;for(const t of e)if(t._id){const e=this.db.delete(t._id);if("string"==typeof e){JSON.parse(e).success&&n++}}return{deletedCount:n}}async countDocuments(t={}){return(await this.find(t).toArray()).length}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}applyUpdate(t,e){const n={...t};if(e.$set&&Object.assign(n,e.$set),e.$unset)for(const t of Object.keys(e.$unset))delete n[t];if(e.$inc)for(const[t,r]of Object.entries(e.$inc))n[t]=(n[t]||0)+r;if(e.$push)for(const[t,r]of Object.entries(e.$push))Array.isArray(n[t])||(n[t]=[]),n[t].push(r);if(e.$pull)for(const[t,r]of Object.entries(e.$pull))Array.isArray(n[t])&&(n[t]=n[t].filter(t=>t!==r));return n}}class C{constructor(t,e={}){this.collections=new Map,this.db=t,this.name=e.name,this.persistence=e.persistence,this.persistence&&this.loadFromStorage()}static async create(t={}){await A();const e=new v;return new C(e,t)}static async createWithServer(t={}){return console.warn("Server sync not available in CDN version. Using local database."),C.create({...t,persistence:!0})}collection(t){if(!this.collections.has(t)){const e=new N(this.db,t);this.collections.set(t,e)}return this.collections.get(t)}loadFromStorage(){if("undefined"==typeof window||!window.localStorage)return;const t=`jsonic_${this.name||"default"}`,e=localStorage.getItem(t);if(e)try{const t=JSON.parse(e);for(const e of t)this.db.insert(JSON.stringify(e))}catch(t){console.error("Failed to load persisted data:",t)}}async close(){this.persistence&&await this.saveToStorage()}async saveToStorage(){if("undefined"==typeof window||!window.localStorage)return;const t=`jsonic_${this.name||"default"}`,e=this.db.list_ids(),n=[];if("string"==typeof e){const t=JSON.parse(e);if(t.success&&Array.isArray(t.data))for(const e of t.data){const t=this.db.get(e);if("string"==typeof t){const e=JSON.parse(t);e.success&&n.push(e.data)}}}localStorage.setItem(t,JSON.stringify(n))}}C.version="3.1.0";var T=C;return r=r.default}()});